"""
Plantilla base para herramientas de automatización en ciberseguridad.

Este script sirve como estructura para practicar:
- lectura de archivos
- procesamiento de datos
- automatización
- requests HTTP
- organización de resultados

Uso exclusivo en entornos autorizados.
"""

import requests
import json
import time


# =========================
# CARGA DE DATOS
# =========================
def cargar_targets(archivo):
    with open(archivo, "r") as f:
        return [line.strip() for line in f.readlines()]


# =========================
# ACCIÓN PRINCIPAL (MODIFICABLE)
# =========================
def accion(target):
    """
    Esta función se modifica según el ejercicio que se quiera practicar.
    Debe devolver siempre un diccionario con resultados.
    """

    url = f"http://{target}"

    try:
        r = requests.get(url, timeout=3)
        return {
            "target": target,
            "alive": True,
            "status": r.status_code
        }

    except Exception:
        return {
            "target": target,
            "alive": False,
            "status": None
        }


# =========================
# LOOP PRINCIPAL
# =========================
def ejecutar(targets):
    resultados = []

    for t in targets:
        print(f"[+] Procesando: {t}")
        resultado = accion(t)
        resultados.append(resultado)
        time.sleep(0.5)

    return resultados


# =========================
# GUARDAR RESULTADOS
# =========================
def guardar_json(nombre, data):
    with open(nombre, "w") as f:
        json.dump(data, f, indent=4)


def guardar_txt(nombre, data):
    with open(nombre, "w") as f:
        for r in data:
            estado = "Alive" if r.get("alive") else "Dead"
            f.write(f"{r.get('target')} - {estado}\n")


# =========================
# MAIN
# =========================
if __name__ == "__main__":
    print("\n=== Script de práctica en Python ===\n")

    targets = cargar_targets("targets.txt")
    resultados = ejecutar(targets)

    guardar_json("resultados.json", resultados)
    guardar_txt("resultados.txt", resultados)

    print("\n✔ Proceso finalizado.\n")
